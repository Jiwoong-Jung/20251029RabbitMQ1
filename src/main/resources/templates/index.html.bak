<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Product Messages</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            margin-top: 50px;
        }

        .card {
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: scale(1.02);
        }

        #messageList {
            margin-top: 30px;
        }

        .btn-send {
            background-color: #0d6efd;
            color: white;
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="mb-4 text-center">ğŸ“¦ Product Message Center</h1>

    <!-- ì…ë ¥ í¼ -->
    <div class="card p-4 mb-4">
        <h4>Send New Message</h4>
        <form id="messageForm">
            <div class="mb-3">
                <label class="form-label">Title</label>
                <input type="text" id="title" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Quantity</label>
                <input type="number" id="quantity" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Product Code</label>
                <input type="text" id="productCode" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Content</label>
                <textarea id="content" class="form-control" rows="3" required></textarea>
            </div>

            <button type="submit" class="btn btn-send w-100">ğŸš€ Send Message</button>
        </form>
    </div>

    <!-- ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸ -->
    <div>
        <h4>ğŸ“œ Sent Messages</h4>
        <div id="messageList" class="row"></div>
    </div>
</div>

<script>
    const apiUrl = "/api/messages";

    // ë©”ì‹œì§€ ëª©ë¡ ë¡œë“œ
    async function loadMessages() {
        const res = await fetch(apiUrl);
        const messages = await res.json();

        const list = document.getElementById("messageList");
        list.innerHTML = "";

        messages.reverse().forEach(msg => {
            const card = document.createElement("div");
            card.className = "col-md-4 mb-3";
            card.innerHTML = `
                <div class="card p-3">
                    <h5>${msg.title}</h5>
                    <p><strong>Product:</strong> ${msg.productCode}</p>
                    <p><strong>Quantity:</strong> ${msg.quantity}</p>
                    <p>${msg.content}</p>
                </div>
            `;
            list.appendChild(card);
        });
    }

    // ë©”ì‹œì§€ ì „ì†¡
    document.getElementById("messageForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const data = {
            title: document.getElementById("title").value,
            quantity: parseInt(document.getElementById("quantity").value),
            productCode: document.getElementById("productCode").value,
            content: document.getElementById("content").value
        };

        const res = await fetch(apiUrl, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(data)
        });

        if (res.ok) {
            alert("âœ… Message sent successfully!");
            document.getElementById("messageForm").reset();
            await loadMessages();
        } else {
            alert("âŒ Failed to send message");
        }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë©”ì‹œì§€ ëª©ë¡ í‘œì‹œ
    loadMessages();
</script>
</body>
</html>
